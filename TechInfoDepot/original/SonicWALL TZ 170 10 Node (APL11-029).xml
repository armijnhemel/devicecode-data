<page>
    <title>SonicWALL TZ 170 10 Node (APL11-029)</title>
    <ns>0</ns>
    <id>38585</id>
    <revision>
      <id>381574</id>
      <parentid>360284</parentid>
      <timestamp>2024-08-16T22:06:25Z</timestamp>
      <contributor>
        <username>ShadowBot</username>
        <id>3357272</id>
      </contributor>
      <minor/>
      <comment>/* top */ clean up</comment>
      <origin>381574</origin>
      <model>wikitext</model>
      <format>text/x-wiki</format>
      <text bytes="13451" sha1="9nw2orw8gq6pd1384h9lfli5egqwemh" xml:space="preserve">{{Infobox Embedded System
|image1             = SonicWALL TZ 170 10 Node (APL11-029).jpg
|image1_size        = 150px
|caption            = SonicWALL TZ 170 10 Node Firewall
|caption2           = &lt;!-- 2nd tagleine --&gt;
|pp                 = &lt;!-- product page url only --&gt;
|sp                 = &lt;!-- Support page url only --&gt;
|dl                 = &lt;!-- Download page url only --&gt;
|fandom             = Sonicwall_TZ-170
|wikidevi           = SonicWALL_TZ_170_10_Node_(APL11-029)
|wikipedia          = &lt;!-- [[wikipedia:Main Page|Wikipedia]] Leave blank for none --&gt;
|ddwrtsupport       = &lt;!-- Activation, Donation, Incompatible, Not Supported, Partial Support, Supported, TBD, Unofficially, WIP --&gt;
|openwrtsupport     = &lt;!-- Incompatible, Not Supported, Partial Support, Supported, WIP, Unofficially, --&gt;
|tomatosupport      = &lt;!-- Incompatible, Not Supported, Partial Support, Supported, WIP, Unofficially, --&gt;
|gargoylesupport    = &lt;!-- Incompatible, Not Supported, Partial Support, Supported, WIP, Unofficially, --&gt;

|brand              = SonicWALL
|model              = TZ 170
|submodelappend     = yes
|submodel           = 10 Node
|revision           = &lt;!-- Model Revision, Leave blank for none or unknown --&gt;
|subrevision        = &lt;!-- Model Subrevision, Leave blank for none or unknown --&gt;
|model_part_num     = APL11-029
|page_start_date    = 07/07/2011
|page_start_origon  = https://infodepot.fandom.com/wiki/Sonicwall_TZ-170
|series             = &lt;!-- Device series --&gt;
|type               = Router Firewall
|sernum             = &lt;!-- First 4 or so for easy version identification --&gt;
|fcc_id             = &lt;!-- Federal Communication Commission Identification Number --&gt;
|icid               = &lt;!-- Industry Canada Identification number, Leave blank for unknown --&gt;
|us_id              = &lt;!-- US ID number --&gt;
|boardid            = &lt;!-- Board Identification, Leave blank for none --&gt;
|ecc_id             = &lt;!-- eec-id --&gt;

|cpu1chip1          = SonicWALL;156-000022-00;
|cpu1_cores         = &lt;!-- 1,2,3,4 --&gt;
|cpu1_type          = &lt;!-- ARM,MIPS,x86-64,PowerPC, --&gt;
|cpu1_type_rev      = &lt;!-- CPU1 type Revision, Leave blank for unknown --&gt;
|cpu1spd            = &lt;!-- undocumented --&gt;
|is_doc             = 
|bus                = &lt;!-- 8-bit, 16-bit, 32-bit, 64-bit, Leave blank for none --&gt;

|flash1type         = &lt;!-- Parallel,Serial(SPI),SPI NOR,NAND,Compact Flash, --&gt;
|fla1_num           = &lt;!-- 1,2,3,4 --&gt;
|fla1chip           = STMicro;M29W640FT-70N6;
|flash1size         = 8
|flash1maxsize      = &lt;!-- Maximum size firmware can be in bytes --&gt;

|ram1type           = &lt;!-- DDR,DDR2,DDR3,DDR4, --&gt;
|ram1type1          = &lt;!-- SO-DIMM,SDRAM, --&gt;
|ram1spd            = &lt;!-- RAM speed --&gt;
|ram1size           = 64
|ram1chip           = Nanya;NT5SV16M16BS-75B;
|ram1_num           = 2
|nvramsize          = &lt;!-- 32, 60, 64, etc... in kb, Leave blank for unknown --&gt;

|eth_cpu            = true
|eth2chip           = Broadcom;BCM5221A4;
|eth3chip           = Broadcom;BCM5221A4;
|sw1chip            = Broadcom;BCM5325MA2;
|dsl_ports          = 
|voip_ports         = 
|wan_ports          = 2
|wan_speed          = 100MbE
|lan_ports          = 5
|lan_speed          = 100MbE
|ethstandard        = &lt;!-- auto --&gt;
|portbasedvlan      = &lt;!-- Support for port based vlan tagging, Leave blank for unknown --&gt;
|802.1qvlan         = &lt;!-- Support for 802.1q vlan tagging, Leave blank for unknown --&gt;
|auto_mdix          = &lt;!-- mdix support --&gt;
|sup_jumbo          = &lt;!-- Jumbo frames support --&gt;
|ethoui             = 00:06:B1

|bootwait           = &lt;!-- On or Off, Leave blank for unknown --&gt;
|stockbootloader    = &lt;!-- Name;Version;Distro --&gt;
|stockos            = &lt;!-- Name;Version;Distro --&gt;

|exp_if_types       = &lt;!-- Expansion Interface types, Leave blank for none --&gt;
|exp_sim_num        = &lt;!-- Number of sim Slots, Leave blank for none --&gt;
|exp_pcmcia_num     = &lt;!-- Number of pcmcia ports, Leave blank for none --&gt;
|exp_expcard_num    = &lt;!-- Number of Expresscard ports, Leave blank for none --&gt;
|exp_minipci_num    = &lt;!-- Number of Mini PCI Slots, Leave blank for none --&gt;
|exp_minipcie_num   = &lt;!-- Number of Mini PCIexpress Slots, Leave blank for none --&gt;
|exp_usb_num        = &lt;!-- Number of USB Ports, Leave blank for none --&gt;
|exp_cf_num         = &lt;!-- Number Compact Flash Slots, Leave blank for none --&gt;
|exp_sdmmc_num      = &lt;!-- Number SD/MMC Slots, Leave blank for none --&gt;
|exp_ide_num        = &lt;!-- Number of ide ports, Leave blank for none --&gt;
|exp_ata_num        = &lt;!-- Number of ATA Ports, Leave blank for none --&gt;
|exp_sata_num       = &lt;!-- Number of sata ports, Leave blank for none --&gt;
|exp_esata_num      = &lt;!-- Number of esata ports, Leave blank for none --&gt;
|exp_parallel       = &lt;!-- Number of parallel ports, Leave blank for none --&gt;
|exp_sfp_num        = &lt;!-- Number of sfp ports, Leave blank for none --&gt;
|exp_M.2            = &lt;!-- Number of M.2 ports, Leave blank for none --&gt;
|usb_hub            = &lt;!-- USB hub compatibility --&gt;

|pwr_volt_type      = VDC
|pwr_vdc            = 5
|pwr_amp_dc         = 2.4
|pwr_conn           = barrel
|pwr_barrel_outer   = 5.5
|pwr_barrel_inner   = 2.1
|pwr_barrel_len     = 9.5
|pwr_pol            = &lt;!-- Connector polarity --&gt;

|serial             = yes,, console port,, RJ45
|jtag               = &lt;!-- Full JTAG info --&gt;

|specialfeat        = &lt;!-- Features that don't fit any place else, Leave blank for none --&gt;
|flags              = RTC w/ battery
|addchip            = RS-232 Transciever;Intersil;ICL3243;;1;,,, 
Hex Schmitt-Trigger Inverter;TI;SN74LVC14A;;1;,,, 
3.3V Zero Delay Buffer;Cypress;CY2309SXC-1;;1;,,, 
Low Voltage Quad 2-Input OR Gate;Fairchild;74LCX32;;1;,,, 
Low Voltage Quad 2-Input NAND Gate;Fairchild;74LVX00;;3;,,, 
Low Voltage Serial Timekeeping Chip;Dallas Semiconductor;DS1672;;1;,,, 
3A Adjustable/Fixed Low Dropout Linear Regulator;Fairchild;FAN1587A;;1;,,, 
1.5A Adjustable/Fixed Low Dropout Linear Regulator;Fairchild;FAN1086;;1;
|802dot11_protocols = none

|defaulip           = 192.168.168.168
|defaultlogin       = admin
|defaultpass        = password
|manuf              = &lt;!-- Manufacturer --&gt;
|manuf_model        = &lt;!-- Manufacturer Model --&gt;
|manuf_rev          = &lt;!-- Manufacturer Revision --&gt;
|is_manuf           = No
|tpfirmware         = &lt;!-- Third party firmware official support, AsusWRT-Merlin, CeroWrt, DD-WRT, DD-WRT (kong), DD-WRT (kongac), DD-WRT (kongarm), FreedomBox, FreshTomato-ARM, Gargoyle, LibreWrt, Oleg (wl500g), Oleg-ng (wl500g), OpenWrt, Tomato, Tomato RAF, Tomato (shibby), Tomato (Toastman), TomatoUSB, Wive-NG --&gt;

|availability       = &lt;!-- Market availability --&gt;
|eoldate            = &lt;!-- End of Life date --&gt;
|fccapprovdate      = &lt;!-- FCCID approval date --&gt;
|estreldate         = &lt;!-- Estimated release date --&gt;
|estprice           = &lt;!-- Estimated retail price in US dollars --&gt;
|upc                = &lt;!-- UPC number --&gt;
|ean                = &lt;!-- EAN number --&gt;
|dx_sku             = &lt;!-- DealExtreme sku --&gt;
|newegg             = &lt;!-- newegg item number --&gt;
|asin               = B0000TN008
|asin_country       = &lt;!-- ASIN country --&gt;
|asin2              = &lt;!-- ASIN number --&gt;
|asin_country2      = &lt;!-- ASIN country --&gt;
|countrymanuf       = China

|buttons            = &lt;!-- buttons available --&gt;
|led                = Green
|dimensions         = &lt;!-- Size of device {{convert |length|x|widthordepth|x|height|in|mm}} --&gt;
|weight             = &lt;!-- Weight of device {{convert|weight|oz|g}} --&gt;

}}{{TIDTOC|embedded}}
==Overview==

{{See also|SonicWALL}}

===Hardware specification===
*CPU: SonicWall [[MIPS]]  
*Memory: 64MB (SDRAM)
*Storage: 8MB NOR Flash
*Network: 7x Fast Ethernet port
*Power: 5V, 2.4A via barrel

==Pictures==
&lt;center&gt;'''User Images'''
&lt;gallery mode=&quot;slideshow&quot;&gt;
File:SonicWALL TZ 170 Top.jpeg|Top
File:SonicWALL TZ 170 Bottom.jpeg|Bottom
File:Sonicwall TZ-170 b.jpg|
File:Sonicwall TZ-170 c.jpg|
File:Console cable pinout.jpg|
&lt;/gallery&gt;&lt;/center&gt;[[Has images::internal| ]]

==Notes==
Can't seem to find a TX or RX, but then again I'm not terribly familiar with serial communications either. Maybe I missed something?

===Firmware Offsets===
&lt;pre&gt;
0x0000 &gt; Section 1         [128 bytes]
  * [49 AF 08 12 30 2C 02 14] &quot;Magic&quot; header, 8 bytes. Found in all firmware images for TZ170
                               and one image for TZ-150.

0x0080 &gt; Section 2         [640 bytes]

0x0300 &gt; Section 3         [128 bytes]
  * 0x0300 - Always &quot;SonicOS Standard&quot; from what I can tell
  * 0x0320 - Firmware revision number, displayed verbatim in web interface
  * 0x0340 - Compiling machine name (?)
  * 0x0380 - Compiling user name (pseudo-confirmed)

0x03c0 &gt; Section 4 [data]  [ to  EOF ]
&lt;/pre&gt;

===Mystery Filesystem===
I could almost write an entirely different post for all the time that I spent decoding this. Having very little prior experience with filesystems, it was definitely a learning adventure to say the least. I haven't been able to figure out how the device decides where this filesystem begins and where it ends, but I am 100% certain that I've decoded the FAT table for whatever filesystem this is. It's worth noting that when you do, however, find the beginning of the FAT table, from that address to the end of the firmware image is the entirety of the filesystem (checked and confirmed by myself on multiple firmware versions).

A FAT entry for this system looks as follows:

&lt;pre&gt;
00 00 3E C6 00 00 25 68 00 00 86 7A 0D 65 76 65 6E 74 6C 69 73 74 2E 74 78 74 00
.  .  &gt;  Æ  .  .  %  h  .  .  †  z  .  e  v  e  n  t  l  i  s  t  .  t  x  t  .

0x0000 - 0x0003 &lt;&gt; Location of file, offset from head of filesystem
0x0004 - 0x0007 &lt;&gt; Size of file in filesystem
0x0008 - 0x000B &lt;&gt; Size of file extracted and uncompressed/decrypted
         0x000C &lt;&gt; Length of filename text
0x000D - to length &lt;&gt; filename + null character
&lt;/pre&gt;

The head of the filesystem is calculated by finding the first entry in the FAT, and subtracting 4 bytes. The 4 bytes before the first entry indicate how many files are stored in the system. For instance, for firmware version 3.1.0.15, there are 511 files contained in the image (encrypted of course). If you do a hex search for 0x01ffh you will find two entries. The first is in the header, the second is about halfway to the end of the file. The second one is what we're looking at. From there, we know that immediately following this WORD value is the first entry in the FAT for &quot;eventlist.txt&quot;. The end of the filesystem can be calculated using the first FAT entry. For the &quot;footer&quot; of this filesystem, there are 8 bytes (two WORD values), right before the offset indicated by the first FAT entry. I have as of right now been unable to figure out what these values are in relation to everything else. They're not a static signature as they vary slightly between firmware versions. However, from what I can tell the first 3 bytes are always [08h 78h 9Ch] (unconfirmed). Hope I haven't forgotten anything!

===Firmware File Names/Versions===
&lt;pre&gt;
  * sw_tz170_s_eng_3.0.0.4.sig  - Version 3.0.0.4  - [ MD5: d3f1c4a1db420ce05cec01a4b822baae ]
  * sw_tz170_s_eng_3.1.0.15.sig - Version 3.1.0.15 - [ MD5: 25f33a66b98e530766b875b76b382370 ]
  * sw_tz170_s_eng_3.1.0.2.sig  - Version 3.1.0.2  - [ MD5: a2a66ddc1921cff321c16202d3c704dd ]
&lt;/pre&gt;

===Miscellaneous Points of Note===
* The system OS is probably VxWorks based...
* As of right now I can not get the TZ-170 to take any modified firmware image. This consisted of editing the &quot;username&quot; field in the header, to which the SonicWall cried out as it was not a &quot;signed&quot; firmware image.
* I have just ordered an RS-232 TTL converter, and as soon as that gets here I will be poking around on the board looking for a secondary UART port. There are some nice pin groupings on the PCB that I can't wait to probe!
* Figuring that I won't have any luck with the TTL converter, I will be trying to find the JTAG pinout of the processor, and hopefully I can dump something interesting/useful. Maybe I'll be able to sign those images! I'll be doing this with an Arduino, because I feel this affords me more flexibility when probing for pins. Plus, you know, Arduino!
* This took me an hour and a half to organize and write, but probably just a few minutes for you to read! :]

===Requests/How You Can Help===
My eventual goal is to port OpenWRT/DD-WRT to this appliance, and hopefully this whole series of appliances! But as of right now I have hit a dead end. So if you have any ideas, experience, or hardware you'd like to contribute to this cause, please feel free to post/message me! Particularly, if you can shed any light onto how these images are encrypted/signed, I would be forever grateful. Also, you're wondering how you're supposed to obtain the firmware images listed above. There is a reason I have included the filename + the MD5 checksum. I'm not entirely sure, however, if Googling these files will return any results. If you would like me to send these images to you for reversing purposes, just message me. I have a nice little 7z archive will all three versions mentioned above sitting on my desktop. Lastly, thank you for taking the time to read this!

==See also==
*[[SonicWALL TZ 100 (APL22-07F)]]
*[[SonicWALL TZ 105W (APL22-09C)]]
*[[SonicWALL TZ 170 (APL11-029)]]
*[[SonicWALL TZ 205 (APL22-09D)]]
*[[SonicWALL TZ 205W (APL22-09E)]]
*[[SonicWALL TZ 210 (APL20-065)]]
*[[SonicWALL TZ 215W (APL24-08F)]]
*[[SonicWALL TZ 250MW (APL25-091)]]

[[Category:English Documentation]]</text>
      <sha1>9nw2orw8gq6pd1384h9lfli5egqwemh</sha1>
    </revision>
  </page>