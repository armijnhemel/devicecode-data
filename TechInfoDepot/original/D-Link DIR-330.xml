<page>
    <title>D-Link DIR-330</title>
    <ns>0</ns>
    <id>5642</id>
    <revision>
      <id>377005</id>
      <parentid>356660</parentid>
      <timestamp>2024-08-15T15:16:30Z</timestamp>
      <contributor>
        <username>ShadowBot</username>
        <id>3357272</id>
      </contributor>
      <minor/>
      <comment>/* top */clean up</comment>
      <origin>377005</origin>
      <model>wikitext</model>
      <format>text/x-wiki</format>
      <text bytes="30086" sha1="dkq746uethrvuxhhpgv9tpzix4mr62p" xml:space="preserve">{{Infobox Embedded System
|image1             = DIR-330 front.jpg
|image1_size        = 150px
|caption            = Wireless G VPN Router, 4-Port 10/100 Switch
|caption2           = &lt;!-- 2nd tagleine --&gt;
|pp                 = &lt;!-- product page url only --&gt;
|sp                 = &lt;!-- Support page url only --&gt;
|dl                 = &lt;!-- Download page url only --&gt;
|fandom             = D-Link_DIR-330_vA1
|wikidevi           = D-Link_DIR-330
|wikipedia          = &lt;!-- [[wikipedia:Main Page|Wikipedia]] Leave blank for none --&gt;
|ddwrtsupport       = Supported
|openwrtsupport     = &lt;!-- Incompatible, Not Supported, Partial Support, Supported, WIP, Unofficially, --&gt;
|tomatosupport      = &lt;!-- Incompatible, Not Supported, Partial Support, Supported, WIP, Unofficially, --&gt;
|gargoylesupport    = &lt;!-- Incompatible, Not Supported, Partial Support, Supported, WIP, Unofficially, --&gt;

|brand              = D-Link
|model              = DIR-330
|submodelappend     = &lt;!-- yes, for space --&gt;
|submodel           = &lt;!-- SubModel number, Leave blank for unknown --&gt;
|revision           = A1
|subrevision        = &lt;!-- Model Subrevision, Leave blank for none or unknown --&gt;
|model_part_num     = 
|page_start_date    = 09/22/2010
|page_start_origon  = https://infodepot.fandom.com/wiki/D-Link_DIR-330_vA1
|wlclass            = G54
|series             = &lt;!-- Device series --&gt;
|type               = wireless router
|sernum             = &lt;!-- First 4 or so for easy version identification --&gt;
|fcc_id             = KA2DIR330A1
|icid               = 4216A-IR330
|us_id              = &lt;!-- US ID --&gt;
|boardid            = 21514DR330A11A1
|ecc_id             = &lt;!-- eec-id --&gt;

|cpu1chip1          = Broadcom;BCM5836P;BCM5836PKPBG;
|cpu1_cores         = 1
|cpu1_type          = MIPS
|cpu1_type_rev      = BMIPS3300
|cpu1spd            = 264&lt;!-- 264 MHz --&gt;
|is_doc             = 
|bus                = &lt;!-- 8-bit, 16-bit, 32-bit, 64-bit, Leave blank for none --&gt;

|flash1type         = &lt;!-- Parallel,Serial(SPI),NAND,Compact Flash --&gt;
|fla1_num           = &lt;!-- 1,2,3,4 --&gt;
|fla1chip           = Spansion;S29GL064A90TFIR3;
|flash1size         = 8
|flash1maxsize      = &lt;!-- Maximum size firmware can be in bytes --&gt;

|ram1type           = &lt;!-- DDR,DDR2,DDR3,DDR4 --&gt;
|ram1type1          = &lt;!-- SO-DIMM,SDRAM --&gt;
|ram1spd            = &lt;!-- RAM speed --&gt;
|ram1size           = 32
|ram1chip           = Mira;P2S28D40CTP;
|ram1_num           = 2
|nvramsize          = &lt;!-- 32, 60, 64, etc... in kb, Leave blank for unknown --&gt;

|eth_cpu            = true
|sw1chip            = Broadcom;BCM5325E;
|wan_ports          = 1
|wan_speed          = 100MbE
|lan_ports          = 4
|lan_speed          = 100MbE
|ethstandard        = &lt;!-- auto --&gt;
|portbasedvlan      = &lt;!-- Support for port based vlan tagging, Leave blank for unknown --&gt;
|802.1qvlan         = &lt;!-- Support for 802.1q vlan tagging, Leave blank for unknown --&gt;
|auto_mdix          = &lt;!-- mdix support --&gt;
|sup_jumbo          = &lt;!-- Jumbo frames support --&gt;
|ethoui             = &lt;!-- Leave blank for unknown --&gt;

|bootwait           = &lt;!-- On or Off, Leave blank for unknown --&gt;
|stockbootloader    = &lt;!-- Name;Version;Distro --&gt;
|stockos            = &lt;!-- Name;Version;Distro --&gt;

|exp_if_types       = USB 1.1, Mini PCI,
|exp_minipci_num    = 1
|exp_usb_num        = 1
|usb_hub            = &lt;!-- USB hub compatibility --&gt;

|pwr_volt_type      = VDC
|pwr_vdc            = 5
|pwr_amp_dc         = 2.5
|pwr_conn           = barrel
|pwr_barrel_outer   = &lt;!-- Outer barrel size in mm --&gt;
|pwr_barrel_inner   = &lt;!-- Inner barrel size in mm --&gt;
|pwr_barrel_len     = &lt;!-- Length of barrel --&gt;
|pwr_pol            = &lt;!-- Connector polarity --&gt;

|serial             = yes,, 6-pad header,, 3.3V TTL,, J3,,
|jtag               = yes,, 14-pad header,, J4,, 

|specialfeat        = &lt;!-- Features that don't fit any place else, Leave blank for none --&gt;
|flags              = &lt;!-- flags, Leave blank for none --&gt;
|addchip            = &lt;!-- Additional Chips --&gt;
|802dot11_protocols = bg

|defaulip           = &lt;!-- ???.???.???.???, default IP Address --&gt;
|defaultlogin       = &lt;!-- default Login Name, Leave blank for unknown --&gt;
|defaultpass        = &lt;!-- default Password, Leave blank for unknown --&gt;
|defaultssid        = &lt;!-- default Wireless ID, Leave blank for unknown --&gt;
|defaultssid_regex  = 
|default_ch         = &lt;!-- Defaults channel(s) Radio(s) are set to --&gt;
|manuf              = Cameo
|manuf_model        = &lt;!-- Manufacturer Model --&gt;
|manuf_rev          = &lt;!-- Manufacturer Revision --&gt;
|is_manuf           = No
|tpfirmware         = DD-WRT, LEDE Project, Vampik

|availability       = &lt;!-- Market availability --&gt;
|eoldate            = &lt;!-- End of Life date --&gt;
|fccapprovdate      = 03/29/2007
|estreldate         = &lt;!-- Estimated release date --&gt;
|estprice           = &lt;!-- Estimated retail price in US dollars --&gt;
|upc                = &lt;!-- UPC number --&gt;
|ean                = &lt;!-- EAN number --&gt;
|dx_sku             = &lt;!-- DealExtreme sku --&gt;
|newegg             = &lt;!-- newegg item number --&gt;
|asin               = &lt;!-- ASIN number --&gt;
|asin_country       = &lt;!-- ASIN country --&gt;
|asin2              = &lt;!-- ASIN number --&gt;
|asin_country2      = &lt;!-- ASIN country --&gt;
|countrymanuf       = China

|buttons            = &lt;!-- buttons available --&gt;
|led                = &lt;!-- Led colors and descriptions --&gt;
|dimensions         = &lt;!-- Size of device {{convert |length|x|widthordepth|x|height|in|mm}} --&gt;
|weight             = &lt;!-- Weight of device {{convert|weight|oz|g}} --&gt;

|wi1_if_name        = 
|rad1chip1          = Broadcom;BCM4318;
|rad1oui            = &lt;!-- Only if different from above OUI --&gt;
|rad1_ant_conn      = RP-SMA,U.FL
|rad1stand          = IEEE 802.11b/g
|rad1g              = 54
|rad1b              = 11
|rad1freq           = 2.4
|rad1correv         = 9
|rad1cap            = &lt;!-- radio capabilities, Leave blank for none or unknown --&gt;

}}{{TIDTOC|embedded}}
==Overview==
Major Edit: 2/10/2010 mpf - Thank you to DarkShadow for starting this Wiki. I am sure he knows how much work is involved with typing tutorials.  Originally, there was much information on the DIR-320. Because that router is such a different animal, I deleted all references to it to avoid confusion.  The info now in the wiki is exclusive to the DIR-330. I have tried to address all of the topics that were present on the DIR-320 to ensure that none of the small suggestions were lost.&lt;br&gt; 
I would strongly suggest if you are looking to install DD-WRT then read this wiki from beginning to end.  Make sure you fully understand what is involved.  It is very hard to write procedures that cater to both experienced and novice users.  Hopefully there is some balance here, but wiki's are generally geared toward the novice.  Step by step instructions are given, but the commands specific to the OS used are not discussed.  If you are not familiar with basic commands like ping, telnet, tftp, etc. learn them before you try to install DD-WRT. I honestly do not want to start a debate about which OS to use, but I will offer some suggestions based on my experience writing and testing this wiki.  Windows (tested w/XP 32 bit) or Linux (tested w/Ubuntu 9.10 32 bit) can be used for installing firmware, but I would strongly recommend Linux for JTAGing. I did use Windows for some JTAG testing, but the Ubuntu 32 bit 9.10 Live CD proved to be a much more solid environment.  That really should not be a suprise to anyone who understands OSs and how they are built. I chose the Live CD because many people may not have Linux installed as a base; this way, anyone can use a Linux environment for a short period of time and have a positive result.  Consult the Ubuntu website for how to download, create and use that disk.&lt;br&gt;
Of course, it goes without saying that if anyone finds an error or the procedure needs to be updated please do so.&lt;br&gt;
All testing in this wiki was with [http://www.dd-wrt.com/site/support/other-downloads?path=others%2Feko%2FBrainSlayer-V24-preSP2%2F12-28-09-r13525%2Fbroadcom%2F Broadcom Generic versions of Brainslayer v24 preSP2 (Build13525)]&lt;br&gt;ht

==Links of Interest==
Official D-Link homepage for the product. Here you find the manual as well as the stock firmware releases:&lt;br&gt;
[http://www.dlink.com/products/?pid=564 Click here]

DD-WRT firmware used during testing of this Wiki:&lt;br&gt;
[http://www.dd-wrt.com/site/support/other-downloads?path=others%2Feko%2FBrainSlayer-V24-preSP2%2F12-28-09-r13525%2Fbroadcom%2F Click here]&lt;br&gt;
There is a file named DIR330 in the directory, it is identical to Mega Generic version.  So, either file may be used.

Peacock Thread refered to in many places:
[http://www.dd-wrt.com/forum/viewtopic.php?t=51486 Click here]

JTAG software version 2-1-4 used for all testing:
[http://www.dd-wrt.com/dd-wrtv2/downloads/others/tornado/jtag/old-versions/tjtagv2-1-4.zip Click here]

Direct link to the CFE and NVRAM that you will need for JTAG support:
[http://www.dd-wrt.com/forum/viewtopic.php?p=405017#405017 Click here]

OpenWRT wiki page for the Dir-330:&lt;br&gt; 
[http://nuwiki.openwrt.org/oldwiki/openwrtdocs/hardware/d_link/dir_330 Click here]

===Forum Threads===
Large thread regarding the debricking of the device. JTAG pin outs in the pics of the next section.&lt;br&gt;
[http://www.dd-wrt.com/phpBB2/viewtopic.php?t=28236&amp;highlight=dir330 Click here]

===Pictures of Hardware===
Picture of the PCB hardware release A1 - here with JTAG Pin identification:&lt;br&gt;
[http://www.dd-wrt.com/phpBB2/viewtopic.php?t=12053&amp;highlight=dir330 Click here]

Universal JTAG cable and instructions:&lt;br&gt;
[http://www.diygadget.com/universal-jtag-adapter-for-routers-modem-fta-and-more.html JTAG cable]&lt;br&gt;
[http://www.tiaowiki.com/w/Universal_JTAG_User_Manual_%28Parallel%29 Instructional JTAG wiki]&lt;br&gt;

==Flashing==
{{Flashnotice}}
===Flashing dd-wrt===
Supported by dd-wrt as of =  v24 rc7 build 9016 20080211 

# When flashing, do not power down unless explicitly told to do so.&lt;br&gt;
# Pay close attention to the IP numbers referenced in various places. They can be different than other routers, especially during firmware recovery.&lt;br&gt;
# Read each section completely before you begin.&lt;br&gt;
# Be patient; use a stopwatch.  Time seems to almost stop while you are waiting to find out if a firmware flash worked.&lt;br&gt;
# Make sure you tell your wife &amp; kids to leave you alone while you flash your router. You do not want to let them see you sweat over something so small and ridiculous.

How to Install DD-WRT from the DLink OEM screen on firmware 1.12:&lt;br&gt;
# Download the Generic Broadcom Mini version and the Mega version if you want to install that as well. Do not try to install the Mega version directly.  Testing showed repeated mixed results including two bricks. Testing always succeeded with Mini installed first.  Rename the MINI file to start with 'dir330'.  OK to rename the MINI file to just dir330.bin; again, filename must just start with 'dir330'.&lt;br&gt;
# If you own a JTAG cable, download version 2-1-4 of tjtag as well just in case things go really astray.&lt;br&gt;
# Make sure your computer is the only device connected to the router.  Port 1 was always connected to for testing.&lt;br&gt;  
# Do a factory reset on the box. Ref Peacock thread. Router should return to DLink factory setting of '''192.168.0.1'''&lt;br&gt;
# Set your PCs static ip to 192.168.0.25, net mask 255.255.255.0, def gateway 192.168.0.1&lt;br&gt;
# Open a web browser (tested with Firefox 3.6 and IE8)- clear cache, cookies, etc.&lt;br&gt;
# Type in 192.168.0.1 in the web browser&lt;br&gt;
# Login default should be username 'admin'leave password blank&lt;br&gt;
# Navigate on DLink pages to Maintenance on the top, then Firmware on the right.&lt;br&gt;
# Click &lt;check now&gt; for the latest firmware- wait for this to fail.  If you do not do this worthless step, you will receive a file name error on the next step. (So I guess it has some worth?)&lt;br&gt;
# Browse to the renamed DD-WRT MINI firmware file on the webpage - remember, this filename must be renamed to start with 'dir330'.&lt;br&gt;
# Click &lt;apply&gt;&lt;br&gt;
# Answer 'OK' on the popup box&lt;br&gt;
# Wait for 2 mins 10 secs and the router will start flashing the blue light. Eventually, the web browser may say the firmware upgrade is complete and to click continue.  Do NOT click the continue button, just move on to the next step.&lt;br&gt;
# Set your PCs static ip to 192.168.1.25, net mask 255.255.255.0, def gateway 192.168.1.1&lt;br&gt;
# Leaving browser window open, then open a terminal or command window.&lt;br&gt;
# Try to ping 192.168.1.1&lt;br&gt;
# After a good ping, telnet into 192.168.1.1&lt;br&gt;
# User name is always 'root' password is 'admin'&lt;br&gt;
# At the '#' prompt, type 'erase nvram' hit &lt;enter&gt;&lt;br&gt;
# At the '#' prompt, type 'exit' hit &lt;enter&gt;&lt;br&gt;
# Cycle power on the router&lt;br&gt;
# You will see the blue light flash and come on for about 30 seconds, flash again then go off.  this is the process of initializing the router and NVRAM.&lt;br&gt;
# Once stable (about 1 min), cycle power on the router again.&lt;br&gt;
# You should now see the blue light flash and come on for only about 8 seconds.&lt;br&gt; 
# You should be able to go back to the browser and type in 192.168.1.1 and see the password reset screen.  Enter username and password info as required.&lt;br&gt;
# DD-WRT MINI is now installed. Proceed on to install the MEGA version&lt;br&gt;

Continue on for MEGA install:&lt;br&gt;

# Navigate on DD-WRT page to Administration - Firmware Upgrade&lt;br&gt;
# Browse for the MEGA firmware file you wish to install.&lt;br&gt;
# Click &lt;Upgrade&gt;&lt;br&gt;
# Wait, watch and do not touch your system; nothing looks like it is happening for a VERY long time. The screen says 'Wait', and they mean it.&lt;br&gt;
# The webpage will count down then stop.  It seems like it may even be hanging. Just wait. &lt;br&gt;
# At 9 minutes 30 seconds in, the blue light on the right of the box should come on. At 10 mins, the blue light should be out, and the web page should reload to the Basic Setup Screen. If after 12 minutes you do not see the blue light flash, you can start over, or go to the flash recovery section.&lt;br&gt;
# Technically, you are done. But, erase the NVRAM again just to ensure total success and normal operations.&lt;br&gt;
# In the command/terminal window, you should be able to ping 192.168.1.1&lt;br&gt;
# After a good ping, telnet into 192.168.1.1&lt;br&gt;
# User name is always 'root', the password is what you set it to at the end of the MINI install.&lt;br&gt;
# At the '#' prompt, type 'erase nvram' hit &lt;enter&gt;&lt;br&gt;
# At the '#' prompt, type 'exit' hit &lt;enter&gt;&lt;br&gt;
# Cycle power on the router&lt;br&gt;
# You will see the blue light flash and come on for about 30 seconds, flash again then go off.  This is the process of initializing the router and NVRAM.&lt;br&gt;
# Once stable (about 1 min), cycle power on the router again.&lt;br&gt;
# You should now see the blue light flash and come on for only about 8 seconds.&lt;br&gt; 
# You should be able to go back to the browser and type in 192.168.1.1 and see the password reset screen.  Enter info as required.&lt;br&gt;
# DD-WRT MEGA is now installed and you shall forever be happy.&lt;br&gt;

==Bad Flash Recovery==
OK, something went wrong with downloading firmware into the DIR-330. Now when you turn on the power, the only lights that come on are the power LED and the Port LED number you are wired to. Don't panic yet. This procedure may be able to take you to DD-WRT Mega.&lt;br&gt;
# Set your PCs static ip to 192.168.0.25, net mask 255.255.255.0, def gateway 192.168.0.1&lt;br&gt;
# Open a terminal or command window.&lt;br&gt;
# Try to ping address - '''192.168.0.2''' -- If you are NOT successful and there is no response, try to reboot/reset with hardware button. Still no success or changes? Proceed to JTAG section.&lt;br&gt; 
# If you can ping '''192.168.0.2''', you should be able to tftp firmware back into the box.  The CFE on this router is waiting on 192.168.0.2 for a firmware upload. Do not waste your time with the emergency reload on 192.168.0.1 web page.  Not only may it not work, it may leave you with only JTAGing as an option.&lt;br&gt;
# Decide what you want to install- this tutorial uses DD-WRT Broadcom Generic Mega.  Filenames are not critical right now.  Suggestions for firmware are either mini, mega or OEM builds. If the OEM build is going to be attempted, see the section on installing the OEM software back into the router.  You may need to perform the steps to clear the NVRAM. This procedure is slightly different than with DD-WRT.&lt;br&gt;
# You should be able to tftp in a binary transfer mode to address 192.168.0.2 with your firmware. A tftp Windows XP example would be: &lt;pre&gt;tftp -i 192.168.0.2 PUT dd-wrt.v24_mega_generic.bin&lt;/pre&gt; *adjust for another OS or filename accordingly. Your mileage may vary.&lt;br&gt;
# Within 30 seconds it should state that the transfer was successful&lt;br&gt;
# WAIT a total of about 3 mins 30 seconds and the blue light should start flashing.&lt;br&gt;
# Set your PCs static ip to 192.168.1.25, net mask 255.255.255.0, def gateway 192.168.1.1&lt;br&gt;
# Try to ping 192.168.1.1&lt;br&gt;
# After a good ping, telnet into 192.168.1.1&lt;br&gt;
# User name is always 'root' password is 'admin'&lt;br&gt;
# At the '#' prompt, type 'erase nvram' hit &lt;enter&gt;&lt;br&gt;
# At the '#' prompt, type 'exit' hit &lt;enter&gt;&lt;br&gt;
# Cycle power on the router&lt;br&gt;
# You will see the blue light flash and come on for about 30 seconds, flash again then go off.  this is the process of initializing the router and NVRAM.&lt;br&gt;
# Once stable (about 1 min), cycle power on the router again.&lt;br&gt;
# You should now see the blue light flash and come on for only about 8 seconds. Life is good again.&lt;br&gt;
# You should be able to open a browser and go to 192.168.1.1 and see the password reset screen.  Enter info as required.&lt;br&gt;
# When the system info screen comes up, verify your MAC has not been corrupted.  Your LAN MAC should be one less than the MAC on the bottom of the case.  Wireless MAC one more than the MAC on the bottom of the case.  It will be obvious because the MAC will be completely different than what is on the bottom of your router.&lt;br&gt;

===Flashing OpenWrt===
Please insert instructions here

==Upgrading==
{{Upgrade dd-wrt}}

==Reverting==
With DD-WRT installed (tested with mini and mega), to go back to D-Link firmware:&lt;br&gt;
# Do a hardware (push the button) reset to return to defaults. Ref Peacock thread. Router should return to '''192.168.1.1'''&lt;br&gt;
# Set your PCs static ip to 192.168.1.25, net mask 255.255.255.0, def gateway 192.168.1.1&lt;br&gt;
# Open a web browser (tested with Firefox 3.6 and IE8)- clear cache, cookies etc.&lt;br&gt;
# Type in 192.168.1.1 in the web browser&lt;br&gt;
# During login, you should set username and password (make them simple) - if not, the hardware reset did not take. Reference the Peacock thread and start over.&lt;br&gt;
# Navigate on DD-WRT page to Administration - Firmware Upgrade, then leave browser window open on this page&lt;br&gt;
# Open a terminal or command window.&lt;br&gt;
# Telnet into the router - 192.168.1.1 &lt;br&gt;
# User name is always 'root' (no matter what you set above), password is what was just setup on the web login&lt;br&gt;
# At the '#' prompt, type 'erase nvram' hit &lt;enter&gt;&lt;br&gt;
# At the '#' prompt, type 'exit' hit &lt;enter&gt;&lt;br&gt;
# Do not close terminal/command window, move back to the browser&lt;br&gt;
# Leave 'after flashing, reset to' box set to &quot;Don't reset&quot;&lt;br&gt;
# Browse for the DLink firmware (currently 1.12) you wish to install&lt;br&gt;
# Click &lt;Upgrade&gt;&lt;br&gt;
# Wait, watch and do not touch your system; nothing looks like it is happening for a VERY long time. Your patience will be tested.&lt;br&gt;
# The webpage will count down then stop.  It seems like it may even be hanging. Just wait.&lt;br&gt;
# At 8 minutes in, the blue light on the right of the box should come on; at 8 mins 30 seconds, the status light should start blinking.  Move on to the next step. If after 10-12 minutes you do not see the blue light flash, you can start over, or go to the flash recovery section.&lt;br&gt;
# Do NOT power down yet; unpredictable results may happen. In the command/terminal window, you should still be able to ping 192.168.1.1&lt;br&gt;
# If you can't ping the router, it either worked or you will need to recover. Skip down to step 25 to test if it accidently worked.&lt;br&gt;
# If you can ping the router on 192.168.1.1, telnet into 192.168.1.1&lt;br&gt;
# It may hang with no response and there will be no username/pwd prompts.  just hit &lt;enter&gt; a few times&lt;br&gt;
# Type 'erase nvram', hit &lt;enter&gt;, type 'exit', hit &lt;enter&gt;&lt;br&gt;
# Power down the router for 5-10 seconds.  Power up the router.&lt;br&gt;
# Once the router is back up after 30 seconds, you should no longer be able to ping 192.168.1.1&lt;br&gt;
# Set your PCs ip to 192.168.0.25, net mask 255.255.255.0, def gateway 192.168.0.1&lt;br&gt;
# Ping test 192.168.0.1&lt;br&gt;
# Type in 192.168.0.1 on the browser; login default should be username 'admin' leave password blank&lt;br&gt;
# Should see the default D-Link screen and then that makes you remember why you went to DD-WRT in the first place!&lt;br&gt;

==JTAG-Serial Info==
===JTAG===
====JTAG Pinouts====


====JTAG Recovery====
The JTAG process should not be feared, but it most certainly should be respected.  You will be working with open unprotected circuit cards, so proper precautions should be maintained with regards to ESDS.  If you have never done a chip level type programming, there are some outstanding wiki's about the subject. [http://www.dd-wrt.com/wiki/index.php/JTAG JTAG wiki]  One the great things about this website is the unbelievable wealth of information that is available.  Again, if you are new to this, spend some time reading.&lt;br&gt;

There are probably a few configurations that will work for the JTAG setup.  What will be discussed here will be a very solid and repeatable setup that worked well for me.&lt;br&gt;

In order to JTAG your router, you will need to either build or purchase a JTAG cable.  Tornado recommends the Universal JTAG cable which is listed in his signature on the forum boards and up top in the Pictures section.  My own experience with it has been very positive. It can be used in several configurations. I found it to be very solid in performance.&lt;br&gt;

The most difficult part about the JTAG process is that it requires a header on J4 be soldered into the router board. Reference the Pics section above.  This can be tricky if you have never performed this type of desoldering and soldering before.  Solder needs to be removed from the holes before pins are inserted or a header strip is inserted. I am not going to go into any detail about this, but if you do not know how easy Electro Static Discharge damage can occur you should not be attempting this step.&lt;br&gt;

As mentioned above, Ubuntu 9.10 32bit Live CD was used for all my testing and recovering.  I did some testing with Windows XP, but found this platform not as repeatable as Linux.&lt;br&gt; 

Up in the information section, there is a link to download the CFE and NVRAM for the DIR-330.  You will need both of these in order to JTAG the box.  Read and follow the instructions in the post to modify the NVRAM file to include your MAC address.  The CFE for this unit looks for the MAC in NVRAM on boot up.  The MAC info is right at the beginning of the NVRAM file and the specifics of how to modify it are in the post.

The following steps should help in achieving your goal:
# Plug the router's power cube into a power strip which contains a switch if you have one.  Most power strips have switches built in these days.  Configure it so that you have easy access to the switch and the keyboard of the computer you will be working with.  You may need to issue commands quickly on power up.&lt;br&gt;
# Do not power up the router at this time.  Do not plug any cords into the router other than from the JTAG cable.  Do not plug the JTAG cable into the computer/laptop.  Do not connect the USB port to the JTAG cable (this is for the universal board listed in the Pictures Section above). &lt;br&gt;
# Using the pictures of the DIR-330 A1 board in the Pictures Section above, connect only to the following pins: nTRST (pin 1), TDI (pin 3), TDO (pin 5), TMS (pin 7), TCK (pin 9) and Ground (pin 2). Use the instructions/wiki for the Universal JTAG board listed above configured for '''Buffered''' mode. Triple check your connections.&lt;br&gt;
# Ensure that the TJTAG program, the CFE and the modified NVRAM are located in a directory you can access once the Live CD is booted.  This can be locally or on a network drive.  You just need to know what directory you are using.  The CFE and NVRAM must be named CFE.BIN and NVRAM.BIN and be located in the exact same directory as the tjtag linux program. Commands concerning file names are case sensitive under Linux.&lt;br&gt;
# Boot up the Ubuntu Live CD.&lt;br&gt;
# Open a terminal window.&lt;br&gt;
# Type 'sudo rmmod lp' hit &lt;enter&gt;&lt;br&gt;
# navigate to the directory containing the Linux version of the tjtag and the CFE/NVRAM files.&lt;br&gt;
# connect the JTAG cable to the computer.&lt;br&gt;
# connect the mini USB cable on the JTAG board to an open USB port.  This is just to supply power to the buffer chip. The light should come on the JTAG board.&lt;br&gt;
# power on the router&lt;br&gt;
# at the prompt, type &quot;sudo ./tjtagv2 -probeonly /wiggler&quot; hit &lt;enter&gt;. Give it several seconds if it does not complete right away.&lt;br&gt;
If you were successful, it should have completed immediately and said &quot;*** REQUESTED OPERATION IS COMPLETE ***&quot;.  The information should show that the processor (Broadcom BCM4704 KPBG Rev 9 CPU chip) and the Flash chip were detected and that the processor entered DEBUG mode. Let's assume that happened and press on...&lt;br&gt;
# Use the up arrow key to recall the previous command -&quot;sudo ./tjtagv2 -probeonly /wiggler&quot; hit &lt;enter&gt;.  You should get the same results.  Wait a few seconds and do it again.  If it is responding every time, then you can proceed with the next steps.&lt;br&gt;
# It has been recommended that the CFE and NVRAM be backed up and saved.  You should do this at least three times to ensure that the setup is working properly.&lt;br&gt;
# The commands are: &quot;sudo ./tjtagv2 -backup:cfe /wiggler /bypass /silent&quot; and &quot;sudo ./tjtagv2 -backup:nvram /wiggler /bypass /silent&quot;.  Every time you issue this command, it will write a new file with a unique timestamp in the tjtag directory.&lt;br&gt;
# If the downloaded CFE files all match, and the downloaded NVRAM files all match, then you can proceed on confidently.&lt;br&gt;
# You can compare the CFE files you downloaded to the one you pulled from the link above in the Information Section. If they match, no need to flash the CFE.  The NVRAM will not match, but you should see your MAC in the files you downloaded unless it was corrupted.&lt;br&gt; 
# From here, you will upload the CFE (if needed) and modified NVRAM with the following commands:&quot;sudo ./tjtagv2 -flash:cfe /wiggler /bypass /silent&quot; and &quot;sudo ./tjtagv2 -flash:nvram /wiggler /bypass /silent&quot;&lt;br&gt;
# Now if things are going really well, just issue the following command: &quot;sudo ./tjtagv2 -erase:kernel /wiggler /bypass /silent&quot;&lt;br&gt;
# You should now be able to proceed to Bad Flash Recovery section above.  Before you do, power down the router, unplug the USB cable and then pull the JTAG board off of the PC.&lt;br&gt;

OK, now let's spend some time working on if you did not detect the CPU or Flash chip. If you did not detect the CPU, go back over the procedure and recheck all of your connections.  You can have some wires misplaced and still grab the CPU. The CPU was always detected even if it would not enter debug mode.  If you cannot detect the CPU, well... :(&lt;br&gt;

# If you detected the CPU (Broadcom BCM4704 KPBG Rev 9 CPU chip) but it was 'hanging' on the flash detection or some other area try the following:  Turn of the router. Prepare the command &quot;sudo ./tjtagv2 -probeonly /wiggler&quot; but do not hit enter.  Power up the router and then hit enter. If it hangs, immediately hit &lt;ctrl&gt;'c' to kill it, up arrow to recall the command and hit &lt;enter&gt; again.  Repeat again and again as fast as possible for 10-15 seconds. 
# If the probe command finished properly and detected the chip during one of those attempts, then you will be able to recover by using this technique to erase the corrupted memory.  If there is no detection, recheck you connections and try cycling the power on the router and try this process again.&lt;br&gt;
# If after doing this a few times, it may seem like there is a small window for you to 'catch' it in for it to work. Repeat the process but now use the following command: &quot;sudo ./tjtagv2 -erase:wholeflash /wiggler /bypass /silent&quot;.  Again, same as before.  On power up, if it does not start working right away, &lt;ctrl&gt;'c' out of it and resend the command.  You may even want to try doing this while holding in the reset button on power up.  Eventually, the command will take and it will erase the whole flash.&lt;br&gt;
# Once the whole flash is erased, cycle power on the router and download the CFE and NVRAM as described above.  Check communications first with the probe command.&lt;br&gt;
# You should now be able to proceed to Bad Flash Recovery section above.  Before you do, power down the router, unplug the USB cable and then pull the JTAG board off of the PC.&lt;br&gt;

Final closing thought on JTAGing; do not try to force detect the memory if you can 'see' the CPU but not the Flash on a probe.  If tjtag is having trouble 'talking' to the CPU, then the CPU is trying to do something else.  During the testing it did not seem helpful to force chip detection. Forcing chip detection on erase or writes made it look like it was doing the process when it actually was not.&lt;br&gt;

===Serial===
====Serial Pinouts====


====Serial Recovery====


==USB Info==
1 usb 2.0 (1x USB 1.1 (According to tech specs on Manufacturer page.
:Port Inactive according to manual))

==vlan Info==


==Pictures==
&lt;center&gt;'''from D-Link'''
&lt;gallery&gt;
File:DIR-330 front.jpg
&lt;/gallery&gt;&lt;/center&gt;[[Has images::retail| ]]
&lt;center&gt;'''User Images&lt;br&gt;from [http://wiki.openwrt.org/_media/toh/d-link/dir300mobo.jpg the OpenWrt wiki] and [https://sites.google.com/site/mobidutch/PCBDIR-330.jpg here]'''
&lt;gallery&gt;
File:Dir300mobo.jpg
File:PCBDIR-330.jpg
&lt;/gallery&gt;&lt;/center&gt;[[Has images::Wikidevi| ]][[Has images::internal| ]]

==Notes==


==Hardware Modification==


==See also==


[[Category:English Documentation]]</text>
      <sha1>dkq746uethrvuxhhpgv9tpzix4mr62p</sha1>
    </revision>
  </page>